{% comment %}
  Announcement Rotator (CSS-only)
  - Up to 4 rich-text announcements
  - Fade in/out via pure CSS (no JS)
  - Background/text color + padding + speed controls
{% endcomment %}

<section
  id="AnnouncementBar-{{ section.id }}"
  class="announcement-rotator-section count-{{ section.blocks.size }}"
  style="
    --ann-speed: {{ section.settings.rotation_ms | default: 5000 }}ms;
    background: {{ section.settings.bg_color | default: '#C8FF63' }};
    color: {{ section.settings.text_color | default: '#000000' }};
    padding: {{ section.settings.padding_y | default: 12 }}px 0;
  "
>
  <div class="announcement-bar--container page-container">
    <div class="announcement-rotator" role="region" aria-live="polite">
      {% if section.blocks.size > 0 %}
        {% for block in section.blocks %}
          {% if block.type == 'message' %}
          <div class="announcement" {{ block.shopify_attributes }}>
            <div class="rt">{{ block.settings.text }}</div>
            {% if block.settings.link_label != blank and block.settings.link_url != blank %}
              <a class="ann-link" href="{{ block.settings.link_url }}">{{ block.settings.link_label }}</a>
            {% endif %}
          </div>
          {% endif %}
        {% endfor %}
      {% else %}
        <div class="announcement">
          <div class="rt">ðŸŽ‰ FLASH SALE! BUY MORE, SAVE MORE!</div>
          <a class="ann-link" href="/collections/all">Shop now</a>
        </div>
      {% endif %}
    </div>
  </div>

  {% stylesheet %}
  #AnnouncementBar-{{ section.id }} .announcement-bar--container {
    display: flex; justify-content: center; align-items: center;
    padding: 0 12px;
  }
  #AnnouncementBar-{{ section.id }} .announcement-rotator {
    display: grid;
    width: 100%;
  }
  #AnnouncementBar-{{ section.id }} .announcement {
    grid-area: 1 / 1;      /* all items overlap */
    justify-self: center;
    margin: 0; text-align: center;
    opacity: 0; transform: translateY(6px);
  }
  #AnnouncementBar-{{ section.id }} .rt {
    font-family: 'Anton', var(--font-heading-family, var(--font-body-family));
    font-weight: 400; font-style: normal;
    font-size: {{ section.settings.font_size | default: 20 }}px;
    line-height: 100%;
    letter-spacing: 0;
  }
  #AnnouncementBar-{{ section.id }} .rt p { margin: 0; }
  #AnnouncementBar-{{ section.id }} .rt p + p { margin-top: .25rem; }

  #AnnouncementBar-{{ section.id }} .ann-link {
    margin-left: .5ch;
    color: inherit;
    text-decoration: underline;
    font: inherit;
    white-space: nowrap;
  }

  /* Keyframes for each slideâ€™s slot within the cycle */
  @keyframes annFade {
    0%   { opacity: 0; transform: translateY(6px); }
    6%   { opacity: 1; transform: translateY(0); }
    28%  { opacity: 1; transform: translateY(0); }
    34%  { opacity: 0; transform: translateY(-6px); }
    100% { opacity: 0; transform: translateY(-6px); }
  }

  #AnnouncementBar-{{ section.id }}.count-0 .announcement:first-child,
  #AnnouncementBar-{{ section.id }}.count-1 .announcement:first-child {
    opacity: 1; transform: none;
  }

  /* 2 slides */
  #AnnouncementBar-{{ section.id }}.count-2 { --ann-cycle: calc(var(--ann-speed) * 2); }
  #AnnouncementBar-{{ section.id }}.count-2 .announcement {
    animation: annFade var(--ann-cycle) linear infinite both;
  }
  #AnnouncementBar-{{ section.id }}.count-2 .announcement:nth-child(1) { animation-delay: calc(var(--ann-speed) * 0); }
  #AnnouncementBar-{{ section.id }}.count-2 .announcement:nth-child(2) { animation-delay: calc(var(--ann-speed) * 1); }

  /* 3 slides */
  #AnnouncementBar-{{ section.id }}.count-3 { --ann-cycle: calc(var(--ann-speed) * 3); }
  #AnnouncementBar-{{ section.id }}.count-3 .announcement {
    animation: annFade var(--ann-cycle) linear infinite both;
  }
  #AnnouncementBar-{{ section.id }}.count-3 .announcement:nth-child(1) { animation-delay: calc(var(--ann-speed) * 0); }
  #AnnouncementBar-{{ section.id }}.count-3 .announcement:nth-child(2) { animation-delay: calc(var(--ann-speed) * 1); }
  #AnnouncementBar-{{ section.id }}.count-3 .announcement:nth-child(3) { animation-delay: calc(var(--ann-speed) * 2); }

  /* 4 slides */
  #AnnouncementBar-{{ section.id }}.count-4 { --ann-cycle: calc(var(--ann-speed) * 4); }
  #AnnouncementBar-{{ section.id }}.count-4 .announcement {
    animation: annFade var(--ann-cycle) linear infinite both;
  }
  #AnnouncementBar-{{ section.id }}.count-4 .announcement:nth-child(1) { animation-delay: calc(var(--ann-speed) * 0); }
  #AnnouncementBar-{{ section.id }}.count-4 .announcement:nth-child(2) { animation-delay: calc(var(--ann-speed) * 1); }
  #AnnouncementBar-{{ section.id }}.count-4 .announcement:nth-child(3) { animation-delay: calc(var(--ann-speed) * 2); }
  #AnnouncementBar-{{ section.id }}.count-4 .announcement:nth-child(4) { animation-delay: calc(var(--ann-speed) * 3); }

  /* Mobile sizing */
  @media (max-width: 640px) {
    #AnnouncementBar-{{ section.id }} .rt {
      font-size: {{ section.settings.font_size | default: 20 | minus: 2 }}px;
    }
  }

  /* Respect reduced motion (still rotates, but with no motion) */
  @media (prefers-reduced-motion: reduce) {
    #AnnouncementBar-{{ section.id }} .announcement { animation: none !important; }
    #AnnouncementBar-{{ section.id }}.count-2 .announcement:nth-child(1),
    #AnnouncementBar-{{ section.id }}.count-3 .announcement:nth-child(1),
    #AnnouncementBar-{{ section.id }}.count-4 .announcement:nth-child(1) { opacity: 1; transform: none; }
  }
  {% endstylesheet %}
</section>

{% schema %}
{
  "name": "Announcement (rotating)",
  "tag": "section",
  "class": "section--announcement-bar",
  "max_blocks": 4,
  "settings": [
    { "type": "color", "id": "bg_color", "label": "Background color", "default": "#C8FF63" },
    { "type": "color", "id": "text_color", "label": "Text color", "default": "#000000" },
    { "type": "range", "id": "font_size", "label": "Font size", "min": 12, "max": 28, "step": 1, "unit": "px", "default": 20 },
    { "type": "range", "id": "padding_y", "label": "Top/bottom padding", "min": 0, "max": 48, "step": 2, "unit": "px", "default": 12 },
    { "type": "range", "id": "rotation_ms", "label": "Rotation speed", "min": 1000, "max": 9000, "step": 250, "unit": "ms", "default": 5000 }
  ],
  "blocks": [
    {
      "type": "message",
      "name": "Announcement",
      "settings": [
        { "type": "richtext", "id": "text", "label": "Announcement text", "default": "<p>ðŸŽ‰ FLASH SALE! BUY MORE, SAVE MORE!</p>" },
        { "type": "text", "id": "link_label", "label": "Link label", "default": "Shop now" },
        { "type": "url", "id": "link_url", "label": "Link URL" }
      ]
    }
  ],
  "presets": [{ "name": "Announcement (rotating)" }]
}
{% endschema %}
