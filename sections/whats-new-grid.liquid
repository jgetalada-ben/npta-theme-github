{% comment %}
  Whats New – Asymmetric Feature Grid
  - Rows are blocks; each row has two cards.
  - Switch which side is large per row.
{% endcomment %}

{% assign mw = section.settings.max_width  | default: '1989px' | strip %}
{% assign mh = section.settings.max_height | default: '1528px' | strip %}

{% unless mw contains 'px' or mw contains '%' or mw contains 'vw' or mw contains 'rem' %}
  {% assign mw = mw | append: 'px' %}
{% endunless %}

{% unless mh contains 'px' or mh contains '%' or mh contains 'vh' or mh contains 'rem' %}
  {% assign mh = mh | append: 'px' %}
{% endunless %}


{% stylesheet %}
    /* Section Heading */
    .wn-heading {
        text-align: left;
        margin-bottom: 4rem;
        padding: 0 50px;
        font-family: var(--font-anton);
    }

    .wn-heading__title {
        font-family: var(--font-anton);
        font-size: clamp(21px, 3vw, 40px);
        font-weight: 400;
        line-height: 1.1;
        color: #01241E;
        text-transform: uppercase;
        margin: 0 0 0.5rem 0;
    }

    .wn-heading__subtitle {
        color: #0b0b0b;
        font-family: var(--font-poppins400);
        font-size: clamp(14px, 1.3vw, 18px);
        line-height: 1.5;
        margin: 0;
    }

    @media (max-width: 768px) {
        .wn-heading {
            padding: 0;
        }
        .wn-heading__title {
            font-size: 28px;
        }
    }
    .wn-grid-section {
        padding: var(--pt) var(--pr) var(--pb) var(--pl);
        overflow: hidden;
        background: transparent;
    }

    .wn-grid-section .wn-wrap {
        margin: 0 auto;
    }

    .wn-grid-section.is-full .wn-wrap {
        max-width: none; 
        max-height: none; 
    }

    .wn-grid-section .wn-row {
        display: grid;
        gap: var(--gap);
        grid-template-columns: 2fr 1fr;
        margin-bottom: var(--gap);
        min-height: var(--row-h);
    }
    .wn-grid-section .wn-row.right-large {
        grid-template-columns: 1fr 2fr; 
    }

    .wn-grid-section .wn-card {
        position: relative;
        border-radius: var(--radius);
        overflow: hidden;
        text-decoration: none;
        color: var(--txt, #fff);
        min-height: 100%;
        display: block;
    }

    .wn-grid-section .wn-card__img {
        position: absolute; inset: 0;
        width: 100%; height: 100%;
        object-fit: cover; object-position: center;
        display: block;
    }

    .wn-grid-section .wn-card__overlay {
        position: absolute; inset: 0;
        background: var(--ovc, #000);
        opacity: var(--ovo, .35);
        pointer-events: none;
    }

    .wn-grid-section .wn-card__content {
        position: absolute; inset: 0;
        display: grid;
        /* align-content: space-between; */
        gap: 10px;
        padding: clamp(30px,4vw,75px);
    }
    .card__item-content {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 100%;
    }
    
    .wn-grid-section .wn-card.is-large .wn-card__body {
        width: 48%;
    }
    .wn-grid-section .wn-card.is-small .wn-card__body {
        width: 75%;
    }
    @media (max-width: 990px) {
        .wn-grid-section {
            padding: 20px;
        }
        .wn-grid-section .wn-row,
        .wn-grid-section .wn-row.left-large,
        .wn-grid-section .wn-row.right-large {
            grid-template-columns: 1fr !important;
        }
        .wn-grid-section .wn-card {
            width: 100%;
            min-height: var(--row-h-m);
        }
        .wn-grid-section .wn-card__content {
            padding: clamp(18px, 4vw, 28px);
        }
        .wn-grid-section .wn-row { gap: var(--gap) !important; }
        .wn-grid-section .wn-card.is-large .wn-card__body,
        .wn-grid-section .wn-card.is-small .wn-card__body {
            width: 100%;
        }
    }
    .wn-grid-section .wn-card__title {
        margin: 0;
        font-family: var(--font-anton);
        font-weight: 400;
        font-size: clamp(18px,2.4vw,36px);
        line-height: 1.05;
        color: inherit;
        text-shadow: 0 1px 1px rgba(0,0,0,.3);
        margin-bottom: 34px;
        text-transform: capitalize;
    }
    .wn-grid-section .wn-card__body { color: inherit; opacity: .95; }
    .wn-grid-section .wn-card__body p { 
        margin: 0;
        font-weight: 500;
        font-size: clamp(14px, 1.3vw, 18px);
        line-height: normal;
        font-family: var(--font-poppins500);
    }
    .wn-grid-section .wn-card__body p + p { margin-top: .35rem; }

    .wn-grid-section .wn-card__btn {
        background: #C8FF63 !important;
        color: #01241E !important;
        width: fit-content;
    }
    .wn-grid-section .wn-card__btn span {
        font-family: var(--font-adirek800);
        font-weight: 600;
        text-transform: uppercase;
    }

    @media (max-width: 990px) {
        .wn-grid-section .wn-row { grid-template-columns: 1fr; min-height: var(--row-h-m); }
        .wn-grid-section .wn-card { min-height: var(--row-h-m); }
        .wn-grid-section .wn-card__title { 
            font-size: 26px; 
            margin-bottom: 10px;
        }
    }
    .wn-card__actions{
    display:flex; align-items:center; gap:14px; margin-top:16px;
    }
    .wn-card__form {line-height: normal;}
    .wn-card__form .wn-card__btn{ background:#C8FF63!important; color:#01241E!important; }
    .wn-card__info{
    --ring: rgba(255,255,255,.85);
    --bg: rgba(0,0,0,.35);
    position:relative; width:27px; height:27px; border-radius:999px;
    display:grid; place-items:center; text-decoration:none;
    /* border:2px solid var(--ring); */
    background:#F2F2E9; color:#000;
    backdrop-filter: blur(2px);
    }
    .wn-card__info-i{ font-family: var(--font-poppins500, sans-serif); font-size:18px; line-height:1; }
    .wn-card__tip{
    position:absolute; bottom:calc(100% + 10px); left:50%; transform:translateX(-50%);
    background:#fff; color:#0B0B0B; font-size:12px; padding:6px 10px; border-radius:999px;
    box-shadow:0 4px 16px rgba(0,0,0,.22);
    opacity:0; pointer-events:none; transition:opacity .15s ease;
    white-space:nowrap;
    }
    .wn-card__info:hover .wn-card__tip{ opacity:1; }

{% endstylesheet %}

<section id="WhatsNew-{{ section.id }}"
  class="wn-grid-section {% if section.settings.full_width %}is-full{% endif %}"
  style="
    --pt: {{ section.settings.pad_top | default: 24 }}px;
    --pr: {{ section.settings.pad_right | default: 16 }}px;
    --pb: {{ section.settings.pad_bottom | default: 24 }}px;
    --pl: {{ section.settings.pad_left | default: 16 }}px;
    --gap: {{ section.settings.gap | default: 16 }}px;
    --radius: {{ section.settings.radius | default: 8 }}px;
    --maxw: {{ section.settings.max_width | default: 1989 }};
    --maxh: {{ section.settings.max_height | default: 1528 }}px;
  "
>
  {% if section.settings.section_title != blank or section.settings.section_subtitle != blank %}
    <div class="wn-heading">
        {% if section.settings.section_title != blank %}
        <h2 class="wn-heading__title">{{ section.settings.section_title }}</h2>
        {% endif %}
        {% if section.settings.section_subtitle != blank %}
        <p class="wn-heading__subtitle">{{ section.settings.section_subtitle }}</p>
        {% endif %}
    </div>
  {% endif %}

  <div class="wn-wrap" style="max-width: {{ mw }}; max-height: {{ mh }};">
    {% for block in section.blocks %}
        <div class="wn-row {% if block.settings.layout == 'left-large' %}left-large{% else %}right-large{% endif %}"
            {{ block.shopify_attributes }}
            style="--row-h: {{ block.settings.row_height_desktop | default: 420 }}px; --row-h-m: {{ block.settings.row_height_mobile | default: 260 }}px;">

            {%- comment -%} LEFT CARD {%- endcomment -%}
            {%- assign lp = block.settings.left_product -%}
            {%- if lp != blank -%}
            {%- assign left_product_obj = all_products[lp] -%}
            {%- endif -%}
            {%- assign left_variant_id = '' -%}
            {%- if block.settings.left_variant_id_override != blank -%}
            {%- assign left_variant_id = block.settings.left_variant_id_override -%}
            {%- elsif left_product_obj and left_product_obj.first_available_variant -%}
            {%- assign left_variant_id = left_product_obj.first_available_variant.id -%}
            {%- endif -%}
            {%- assign left_learn_url = block.settings.left_link -%}
            {%- if left_product_obj and left_product_obj.url != blank -%}
            {%- assign left_learn_url = left_product_obj.url -%}
            {%- endif -%}

            <div class="wn-card {% if block.settings.layout == 'left-large' %}is-large{% else %}is-small{% endif %}"
            style="
                --txt: {{ block.settings.left_text_color | default: '#FFFFFF' }};
                --ovc: {{ block.settings.left_overlay_color | default: '#000000' }};
                --ovo: {{ block.settings.left_overlay_opacity | default: 35 | divided_by: 100.0 }};
            ">
            {% if block.settings.left_image != blank %}
                {{ block.settings.left_image
                | image_url: width: 2400
                | image_tag: class: 'wn-card__img', loading: 'lazy', alt: block.settings.left_heading }}
            {% endif %}
            <div class="wn-card__overlay"></div>

            <div class="wn-card__content">
                <div class="card__item-content">
                <div class="card__item-content-header">
                    {% if block.settings.left_heading != blank %}
                    <h3 class="wn-card__title">{{ block.settings.left_heading }}</h3>
                    {% endif %}
                    {% if block.settings.left_body != blank %}
                    <div class="wn-card__body">{{ block.settings.left_body }}</div>
                    {% endif %}
                </div>

                <div class="wn-card__actions">
                    {% if left_variant_id != '' %}
                    <form method="post" action="/cart/add" class="wn-card__form" novalidate>
                        <input type="hidden" name="id" value="{{ left_variant_id }}">
                        <button type="submit" class="btn button-yg wn-card__btn">
                        <span class="btn-label-down">{{ block.settings.left_btn_label | default: 'Add to Cart' }}</span>
                        <span class="btn-label-down">{{ block.settings.left_btn_label | default: 'Add to Cart' }}</span>
                        </button>
                    </form>
                    {% endif %}

                    {% if left_learn_url != blank %}
                    <a href="{{ left_learn_url }}" class="wn-card__info" aria-label="Learn more">
                        <span class="wn-card__info-i">i</span>
                        <span class="wn-card__tip">Learn More</span>
                    </a>
                    {% endif %}
                </div>
                </div>
            </div>
            </div>

            {%- comment -%} RIGHT CARD {%- endcomment -%}
            {%- assign rp = block.settings.right_product -%}
            {%- if rp != blank -%}
            {%- assign right_product_obj = all_products[rp] -%}
            {%- endif -%}
            {%- assign right_variant_id = '' -%}
            {%- if block.settings.right_variant_id_override != blank -%}
            {%- assign right_variant_id = block.settings.right_variant_id_override -%}
            {%- elsif right_product_obj and right_product_obj.first_available_variant -%}
            {%- assign right_variant_id = right_product_obj.first_available_variant.id -%}
            {%- endif -%}
            {%- assign right_learn_url = block.settings.right_link -%}
            {%- if right_product_obj and right_product_obj.url != blank -%}
            {%- assign right_learn_url = right_product_obj.url -%}
            {%- endif -%}

            <div class="wn-card {% if block.settings.layout == 'left-large' %}is-small{% else %}is-large{% endif %}"
            style="
                --txt: {{ block.settings.right_text_color | default: '#FFFFFF' }};
                --ovc: {{ block.settings.right_overlay_color | default: '#000000' }};
                --ovo: {{ block.settings.right_overlay_opacity | default: 35 | divided_by: 100.0 }};
            ">
            {% if block.settings.right_image != blank %}
                {{ block.settings.right_image
                | image_url: width: 2400
                | image_tag: class: 'wn-card__img', loading: 'lazy', alt: block.settings.right_heading }}
            {% endif %}
            <div class="wn-card__overlay"></div>

            <div class="wn-card__content">
                <div class="card__item-content">
                <div class="card__item-content-header">
                    {% if block.settings.right_heading != blank %}
                    <h3 class="wn-card__title">{{ block.settings.right_heading }}</h3>
                    {% endif %}
                    {% if block.settings.right_body != blank %}
                    <div class="wn-card__body">{{ block.settings.right_body }}</div>
                    {% endif %}
                </div>

                <div class="wn-card__actions">
                    {% if right_variant_id != '' %}
                    <form method="post" action="/cart/add" class="wn-card__form" novalidate>
                        <input type="hidden" name="id" value="{{ right_variant_id }}">
                        <button type="submit" class="btn button-yg wn-card__btn">
                        <span class="btn-label-down">{{ block.settings.right_btn_label | default: 'Add to Cart' }}</span>
                        <span class="btn-label-down">{{ block.settings.right_btn_label | default: 'Add to Cart' }}</span>
                        </button>
                    </form>
                    {% endif %}

                    {% if right_learn_url != blank %}
                    <a href="{{ right_learn_url }}" class="wn-card__info" aria-label="Learn more">
                        <span class="wn-card__info-i">i</span>
                        <span class="wn-card__tip">Learn More</span>
                    </a>
                    {% endif %}
                </div>
                </div>
            </div>
            </div>
        </div>
    {% endfor %}
  </div>
</section>

{% schema %}
{
  "name": "What's New Grid",
  "tag": "section",
  "class": "wn-grid",
  "max_blocks": 8,
  "settings": [
    { "type": "checkbox", "id": "full_width", "label": "Full width (ignore max width/height)", "default": false },

    { "type": "text", "id": "max_width", "label": "Max width (e.g. 1989px)", "default": "1989px" },
    { "type": "text", "id": "max_height", "label": "Max height (e.g. 1528px)", "default": "1528px" },

    { "type": "text", "id": "section_title", "label": "Section title", "default": "WHAT’S NEW" },
    { "type": "text", "id": "section_subtitle", "label": "Section subtitle", "default": "Stay ahead with the latest programs, partnerships, and exclusive deals designed to elevate your fitness career!" },

    { "type": "header", "content": "Padding" },
    { "type": "range", "id": "pad_top", "min": 0, "max": 120, "step": 4, "unit": "px", "label": "Padding top", "default": 24 },
    { "type": "range", "id": "pad_right", "min": 0, "max": 120, "step": 4, "unit": "px", "label": "Padding right", "default": 16 },
    { "type": "range", "id": "pad_bottom", "min": 0, "max": 120, "step": 4, "unit": "px", "label": "Padding bottom", "default": 24 },
    { "type": "range", "id": "pad_left", "min": 0, "max": 120, "step": 4, "unit": "px", "label": "Padding left", "default": 16 },

    { "type": "range", "id": "gap", "label": "Row/card gap", "min": 0, "max": 48, "step": 2, "unit": "px", "default": 16 },
    { "type": "range", "id": "radius", "label": "Card corner radius", "min": 0, "max": 24, "step": 1, "unit": "px", "default": 8 }
  ],
  "blocks": [
    {
        "type": "row",
        "name": "Row",
        "settings": [
        { "type": "select", "id": "layout", "label": "Layout", "options": [
            { "value": "left-large", "label": "Left card is large" },
            { "value": "right-large", "label": "Right card is large" }
        ], "default": "left-large" },

        { "type": "range", "id": "row_height_desktop", "label": "Row min-height (desktop)", "min": 300, "max": 720, "step": 10, "unit": "px", "default": 460 },
        { "type": "range", "id": "row_height_mobile",  "label": "Row min-height (mobile)",  "min": 200, "max": 520, "step": 10, "unit": "px", "default": 300 },

        { "type": "header", "content": "Left card" },
        { "type": "image_picker", "id": "left_image", "label": "Image" },

        { "type": "product", "id": "left_product", "label": "Product to add (left)" },
        { "type": "text", "id": "left_variant_id_override", "label": "Variant ID override (optional)" },

        { "type": "text", "id": "left_heading", "label": "Heading", "default": "Social Media Influencer" },
        { "type": "richtext", "id": "left_body", "label": "Body", "default": "<p>Expand your reach, attract clients, and boost your brand with strategies top influencers use to succeed online.</p>" },

        { "type": "text", "id": "left_btn_label", "label": "Button label", "default": "Add to Cart" },

        { "type": "url", "id": "left_link", "label": "Fallback learn-more URL" },

        { "type": "color", "id": "left_text_color", "label": "Text color", "default": "#FFFFFF" },
        { "type": "color", "id": "left_overlay_color", "label": "Overlay color", "default": "#000000" },
        { "type": "range", "id": "left_overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 90, "step": 5, "unit": "%", "default": 35 },

        { "type": "header", "content": "Right card" },
        { "type": "image_picker", "id": "right_image", "label": "Image" },

        { "type": "product", "id": "right_product", "label": "Product to add (right)" },
        { "type": "text", "id": "right_variant_id_override", "label": "Variant ID override (optional)" },

        { "type": "text", "id": "right_heading", "label": "Heading", "default": "Advanced Cardio Programming" },
        { "type": "richtext", "id": "right_body", "label": "Body", "default": "<p>Harness cutting-edge science to design powerful, personalized programs that deliver unstoppable client results.</p>" },

        { "type": "text", "id": "right_btn_label", "label": "Button label", "default": "Add to Cart" },

        { "type": "url", "id": "right_link", "label": "Fallback learn-more URL" },

        { "type": "color", "id": "right_text_color", "label": "Text color", "default": "#FFFFFF" },
        { "type": "color", "id": "right_overlay_color", "label": "Overlay color", "default": "#000000" },
        { "type": "range", "id": "right_overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 90, "step": 5, "unit": "%", "default": 35 }
        ]
    }
  ],
  "presets": [{ "name": "What's New Grid" }]
}
{% endschema %}
